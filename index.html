
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ª£p ƒê·ªìng Cung C·∫•p D·ªãch V·ª• - 2H STUDIO</title>
    
    <!-- Libraries for PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;700&display=swap');

        :root {
            --page-width: 210mm;
            --page-height: 297mm;
            --main-padding: 15mm;
        }

        body {
            font-family: 'Be Vietnam Pro', sans-serif;
            font-size: 10pt;
            line-height: 1.5;
            color: #212529;
            background-color: #e0e0e0;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .actions-container {
            position: sticky; top: 0; width: 100%; background-color: #343a40; padding: 10px 0;
            text-align: center; z-index: 2000; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .actions-container button {
            background-color: #0d6efd; color: white; border: none; padding: 10px 20px; border-radius: 5px;
            font-family: 'Be Vietnam Pro', sans-serif; font-size: 14px; font-weight: 500; cursor: pointer;
            margin: 0 10px; transition: background-color 0.3s;
        }
        .actions-container button:hover { background-color: #0b5ed7; }
        .actions-container button#download-pdf { background-color: #198754; }
        .actions-container button#download-pdf:hover { background-color: #157347; }
        .actions-container button:disabled { background-color: #6c757d; cursor: not-allowed; }

        .a4-page {
            width: var(--page-width); min-height: var(--page-height); padding: var(--main-padding);
            box-sizing: border-box; background-color: white; margin: 20px 0;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1); position: relative;
        }
        
        .watermark {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 80pt; color: rgba(0, 0, 0, 0.05); font-weight: 700;
            text-transform: uppercase; pointer-events: none; z-index: 1000; display: none;
        }

        /* All other styles are nested inside .a4-page */
        .a4-page .header { display: flex; align-items: flex-start; border-bottom: 1px solid #dee2e6; padding-bottom: 15px; margin-bottom: 20px; }
        .a4-page .logo { text-align: center; border: 2px solid #333; padding: 10px; border-radius: 50%; width: 90px; height: 90px; display: flex; flex-direction: column; justify-content: center; flex-shrink: 0; }
        .a4-page .logo .main-text { font-size: 22pt; font-weight: 700; }
        .a4-page .logo .sub-text { font-size: 7pt; letter-spacing: 0.5px; }
        .a4-page .studio-info { flex-grow: 1; padding-left: 20px; }
        .a4-page .studio-info h2 { margin: 0 0 8px 0; font-size: 14pt; }
        .a4-page .studio-info p { margin: 1px 0; font-size: 9pt; }
        .a4-page .main-title { text-align: center; font-size: 18pt; font-weight: 700; margin: 20px 0 25px 0; text-transform: uppercase; color: #343a40; }
        .a4-page .intro-text { margin-bottom: 20px; }
        .a4-page .info-grid { display: flex; justify-content: space-between; margin-bottom: 20px; }
        .a4-page .info-grid div { width: 48%; }
        .a4-page .info-grid p { margin: 3px 0; }
        .a4-page table { width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 9.5pt; }
        .a4-page th, .a4-page td { border: 1px solid #dee2e6; padding: 8px; text-align: left; vertical-align: top; }
        .a4-page th { background-color: #e9ecef; font-weight: 700; text-align: center; }
        .a4-page .details-col { white-space: pre-line; text-align: left; }
        .a4-page .center-align { text-align: center; }
        .a4-page .right-align { text-align: right; }
        .a4-page #service-table-body tr:nth-child(even) { background-color: #f8f9fa; }
        
        .a4-page .summary-and-payment { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 25px; }
        .a4-page .qr-payment-section { width: 48%; border: 1px solid #e9ecef; padding: 15px; border-radius: 5px; }
        .a4-page .qr-payment-section h3 { margin-top: 0; text-align: center; font-size: 12pt; border-bottom: 1px solid #dee2e6; padding-bottom: 10px; margin-bottom: 15px; }
        .a4-page .qr-content { display: flex; align-items: center; }
        .a4-page .qr-code { flex-shrink: 0; margin-right: 15px; }
        .a4-page .qr-code img { width: 120px; height: 120px; border: 1px solid #ccc; display: block; }
        .a4-page .qr-info p { margin: 2px 0; font-size: 9pt; }
        
        .a4-page .summary-section { width: 48%; }
        .a4-page .summary-table { width: 100%; }
        .a4-page .summary-table td { border: none; padding: 5px 8px; }
        .a4-page .summary-table tr:not(:last-child) td { border-bottom: 1px solid #e9ecef; }
        .a4-page .summary-table .label { font-weight: 500; }
        .a4-page .summary-table .highlight-red { color: #dc3545; font-weight: 700; font-size: 11pt; }
        .a4-page .summary-table .total-due { font-weight: 700; }
        .a4-page #amount-in-words { font-style: italic; font-weight: bold; }
        
        .a4-page .terms-section { margin-top: 20px; border-top: 1px solid #dee2e6; padding-top: 15px; }
        .a4-page .terms-section h3 { font-size: 12pt; font-weight: 700; margin-top: 15px; margin-bottom: 8px; }
        .a4-page .terms-section p, .a4-page .terms-section li { margin-bottom: 6px; }
        .a4-page .terms-section ul { padding-left: 20px; list-style-type: none; }
        .a4-page .terms-section ul li::before { content: "- "; }
        
        .a4-page .signature-block { display: flex; justify-content: space-around; text-align: center; margin-top: 50px; padding-top: 15px; border-top: 1px solid #dee2e6; }
        .a4-page .signature-block div { width: 30%; }
        .a4-page .signature-block .role { font-weight: 700; }
        .a4-page .signature-block .instruction { font-style: italic; font-size: 9pt; color: #6c757d; }
        .a4-page .signature-block .name { margin-top: 60px; font-weight: 700; }

        /* Print-specific styles */
        @media print {
            body { background: none; }
            .actions-container { display: none; }
            .a4-page { margin: 0; box-shadow: none; border-radius: 0; width: 100%; min-height: 0; padding: 0; }
            .terms-section, .signature-block { page-break-inside: avoid; }
        }
    </style>
</head>
<body>

    <!-- Hidden data containers from AppSheet -->
    <script id="json-data" type="application/json">{{ChiTietDonHangJSON}}</script>
    <div id="payment-data" style="display:none">
        <span id="data-ma-hop-dong">{{ma_hop_dong}}</span>
        <span id="data-ma-bank">{{ma_bank}}</span>
        <span id="data-stk">{{stk}}</span>
        <span id="data-chu-tai-khoan">{{chu_tai_khoan}}</span>
    </div>

    <div class="actions-container">
        <button onclick="window.print()">üñ®Ô∏è In H·ª£p ƒê·ªìng</button>
        <button id="download-pdf">üìÑ T·∫£i v·ªÅ PDF</button>
    </div>

    <div class="a4-page" id="a4-page-content">
        <div id="watermark" class="watermark">B·∫¢N NH√ÅP</div>
        
        <header class="header">
             <div class="logo">
                <span class="main-text">2H</span>
                <span class="sub-text">STUDIO</span>
            </div>
            <div class="studio-info">
                <h2>2H STUDIO - S∆†N T√ÇY</h2>
                <p><strong>ƒê·ªãa ch·ªâ:</strong> 566 Ch√πa Th√¥ng - S∆°n T√¢y - H√† N·ªôi</p>
                <p><strong>Website:</strong> http://2hstudio.vn/</p>
                <p><strong>Fanpage:</strong> https://www.facebook.com/profile.php?id=61559446821981</p>
                <p><strong>Email:</strong> 2hstudio.wedding@gmail.com</p>
                <p><strong>ƒêi·ªán tho·∫°i:</strong> 0854623566 &nbsp;&nbsp;<strong>Zalo:</strong> 2H studio</p>
            </div>
        </header>

        <h1 class="main-title">H·ª¢P ƒê·ªíNG CUNG C·∫§P D·ªäCH V·ª§</h1>
        
        <p class="intro-text"><strong>2H STUDIO - S∆†N T√ÇY</strong> G·ª≠i t·ªõi qu√Ω kh√°ch h√†ng ho√° ƒë∆°n d·ªãch v·ª• nh∆∞ sau:</p>

        <div class="info-grid">
            <div class="customer-info">
                <p><strong>Kh√°ch h√†ng:</strong> <span id="customer-name">{{khach_hang}}</span></p>
                <p><strong>ƒêi·ªán tho·∫°i:</strong> <span id="customer-phone">{{dien_thoai_kh}}</span></p>
                <p><strong>ƒê·ªãa ch·ªâ:</strong> <span id="customer-address">{{dia_chi_kh}}</span></p>
            </div>
            <div class="staff-info">
                <p><strong>Nh√¢n vi√™n:</strong> <span id="staff-name">{{nhan_vien}}</span></p>
                <p><strong>S·ªë ƒëi·ªán tho·∫°i nh√¢n vi√™n:</strong> <span id="staff-phone">{{dien_thoai_nv}}</span></p>
                <p><strong>Ch·ª©c V·ª•:</strong> <span id="staff-title">{{chuc_vu_nv}}</span></p>
            </div>
        </div>

        <table>
            <thead>
                <tr>
                    <th style="width: 5%;">STT</th><th style="width: 20%;">T√™n d·ªãch v·ª•, s·∫£n ph·∫©m</th><th>Chi ti·∫øt</th>
                    <th style="width: 7%;">S·ªë l∆∞·ª£ng</th><th style="width: 12%;">N·ªôi dung khuy·∫øn m·∫°i</th><th style="width: 12%;">S·ªë ti·ªÅn khuy·∫øn m·∫°i</th>
                    <th style="width: 12%;">Ghi ch√∫</th>
                </tr>
            </thead>
            <tbody id="service-table-body"></tbody>
        </table>

        <div class="summary-and-payment">
            <div class="qr-payment-section">
                <h3>Thanh to√°n qua VietQR</h3>
                <div class="qr-content">
                    <div class="qr-code">
                        <img id="qr-code-img" src="" alt="VietQR Code">
                    </div>
                    <div class="qr-info">
                        <p><strong>Ng√¢n h√†ng:</strong> <span id="bank-name"></span></p>
                        <p><strong>S·ªë t√†i kho·∫£n:</strong> <span id="account-number"></span></p>
                        <p><strong>Ch·ªß t√†i kho·∫£n:</strong> <span id="account-name"></span></p>
                        <p><strong>S·ªë ti·ªÅn:</strong> <span id="qr-amount" style="font-weight:bold; color: #dc3545;"></span></p>
                        <p><strong>N·ªôi dung:</strong> <span id="qr-info" style="font-weight:bold;"></span></p>
                    </div>
                </div>
            </div>
            <div class="summary-section">
                <table class="summary-table">
                    <tbody>
                        <tr><td class="label">Th√†nh ti·ªÅn:</td><td class="right-align"><span id="subtotal">{{thanh_tien}}</span></td></tr>
                        <tr><td class="label">T·ªïng ti·ªÅn ph√°t sinh:</td><td class="right-align"><span id="additional-cost">{{tong_phat_sinh}}</span></td></tr>
                        <tr><td class="label total-due">Ph·∫£i thanh to√°n:</td><td class="right-align total-due"><span id="total-due">{{phai_thanh_toan}}</span></td></tr>
                        <tr><td class="label">ƒê√£ thanh to√°n:</td><td class="right-align"><span id="amount-paid">{{da_thanh_toan}}</span></td></tr>
                        <tr><td class="label highlight-red">C√≤n L·∫°i:</td><td class="right-align highlight-red"><span id="amount-remaining">{{con_lai}}</span></td></tr>
                        <tr><td colspan="2">(B·∫±ng ch·ªØ: <span id="amount-in-words"></span>)</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="terms-section">
            <h3>H√¨nh th·ª©c thanh to√°n:</h3>
            <ul>
                <li>L·∫ßn 1 : 20% ( ƒë·∫∑t c·ªçc )</li>
                <li>L·∫ßn 2 : 70% (cu·ªëi bu·ªïi ch·ª•p h√¨nh)</li>
                <li>L·∫ßn 3 : 10% ( khi nh·∫≠n ·∫£nh in )</li>
            </ul>
            <p><strong>Ph∆∞∆°ng th·ª©c thanh to√°n:</strong> Chuy·ªÉn kho·∫£n ho·∫∑c Ti·ªÅn m·∫∑t</p>
            
            <p><strong>Hai b√™n th·ªëng nh·∫•t k√Ω h·ª£p ƒë·ªìng v·ªõi nh·ªØng ƒëi·ªÅu kho·∫£n nh∆∞ sau:</strong></p>

            <h3>ƒêi·ªÅu 1: Tr√°ch nhi·ªám v√† quy·ªÅn l·ª£i c·ªßa c√°c B√™n</h3>
            <p><strong>1.1. Tr√°ch nhi·ªám v√† quy·ªÅn l·ª£i c·ªßa b√™n A:</strong></p>
            <ul>
                <li>B√™n A c√≥ tr√°ch nhi·ªám thanh to√°n cho B√™n B ph√≠ d·ªãch v·ª• ƒë√∫ng h·∫°n theo h√¨nh th·ª©c thanh to√°n n√™u tr√™n.</li>
                <li>B√™n A ƒë∆∞·ª£c nh·∫≠n to√†n b·ªô s·∫£n ph·∫©m theo ph·∫ßn chi ti·∫øt c·ªßa h·ª£p ƒë·ªìng n√†y.</li>
                <li>Tr∆∞·ªùng h·ª£p b√™n A h·ªßy h·ª£p ƒë·ªìng s·∫Ω m·∫•t to√†n b·ªô ti·ªÅn ƒë·∫∑t c·ªçc.</li>
                <li>B√™n A ƒë∆∞·ª£c quy·ªÅn ho√£n ch·ª•p h√¨nh (quay video) 01 l·∫ßn m√† kh√¥ng b·ªã t√≠nh ph√≠ nh∆∞ng ph·∫£i b√°o tr∆∞·ªõc cho b√™n B mu·ªôn nh·∫•t 3 ng√†y tr∆∞·ªõc ng√†y ch·ª•p.</li>
                <li>N·∫øu b√™n A ti·∫øp t·ª•c ph√°t sinh vi·ªác ho√£n l·ªãch th√¨ s·∫Ω ch·ªãu chi ph√≠ ph√°t sinh: 1.000.000 VND/l·∫ßn.</li>
                <li>B√™n A ƒë∆∞·ª£c quy·ªÅn ho√£n ch·ª•p h√¨nh 01 l·∫ßn v√†o ng√†y ch·ª•p trong tr∆∞·ªùng h·ª£p kh√°ch quan th·ªùi ti·∫øt x·∫•u, tuy nhi√™n B√™n A ph·∫£i thanh to√°n c√°c chi ph√≠ c·ªë ƒë·ªãnh ƒë√£ ph√°t sinh trong ng√†y n√†y - VD: Hoa tay, thu√™ xe, trang ƒëi·ªÉm.</li>
                <li>B√™n A t·ª± ch·ªãu tr√°ch nhi·ªám v·ªÅ an to√†n c√° nh√¢n trong qu√° tr√¨nh ch·ª•p ·∫£nh, quay phim.</li>
                <li>Tr∆∞·ªùng h·ª£p b√™n A h·ªßy h·ª£p ƒë·ªìng sau khi ch·ª•p ƒë√£ copy to√†n b·ªô file g·ªëc s·∫Ω kh√¥ng nh·∫≠n l·∫°i ƒë∆∞·ª£c ti·ªÅn thanh to√°n 2 l·∫ßn ƒë·∫∑t c·ªçc.</li>
                <li>Tr∆∞·ªùng h·ª£p b√™n A mu·ªën copy file Raw, s·∫Ω thanh to√°n h·∫øt ph√≠ d·ªãch v·ª•.</li>
            </ul>
            <p><strong>1.2. Tr√°ch nhi·ªám v√† quy·ªÅn l·ª£i c·ªßa B√™n B:</strong></p>
            <ul>
                <li>B√™n B c√≥ tr√°ch nhi·ªám th·ª±c hi·ªán ƒë·∫ßy ƒë·ªß c√°c n·ªôi dung nghi·ªáp v·ª• t∆∞∆°ng ·ª©ng v·ªõi c√°c d·ªãch v·ª• k√Ω k·∫øt, ƒë∆∞·ª£c ni√™m y·∫øt c√¥ng khai k√®m theo b√°o gi√°.</li>
                <li>B√™n B ƒë·∫£m b·∫£o th·ª±c hi·ªán h·ª£p ƒë·ªìng n√†y v·ªõi ch·∫•t l∆∞·ª£ng cao v√† nhi·ªát t√¨nh v·ªõi c√¥ng vi·ªác, ƒë√∫ng nguy√™n t·∫Øc minh b·∫°ch, trung th·ª±c, uy t√≠n, kh√°ch quan v√† b√≠ m·∫≠t v·ªÅ th√¥ng tin c√° nh√¢n c·ªßa kh√°ch h√†ng.</li>
            </ul>

            <h3>ƒêi·ªÅu 2: Cam k·∫øt th·ª±c hi·ªán</h3>
            <ul>
                <li>Hai b√™n cam k·∫øt th·ª±c hi·ªán t·∫•t c·∫£ c√°c ƒëi·ªÅu kho·∫£n ƒë√£ ghi trong h·ª£p ƒë·ªìng.</li>
                <li>Trong qu√° tr√¨nh th·ª±c hi·ªán n·∫øu g·∫∑p kh√≥ khƒÉn hai B√™n ph·∫£i k·ªãp th·ªùi th√¥ng b√°o cho nhau, c·∫ßn thi·∫øt th√¨ trao ƒë·ªïi b·∫±ng vƒÉn b·∫£n t√¨m gi·∫£i ph√°p th√≠ch h·ª£p.</li>
            </ul>
            <p>H·ª£p ƒë·ªìng n√†y ƒë∆∞·ª£c l·∫≠p th√†nh 02 b·∫£n c√≥ gi√° tr·ªã nh∆∞ nhau, B√™n A gi·ªØ 01 b·∫£n, B√™n B gi·ªØ 01 b·∫£n v√† c√≥ hi·ªáu l·ª±c k·ªÉ t·ª´ ng√†y k√Ω h·ª£p ƒë·ªìng, cho ƒë·∫øn khi b√™n B ho√†n th√†nh c√°c d·ªãch v·ª• quy ƒë·ªãnh t·∫°i ƒêi·ªÅu 1 v√† B√™n A thanh to√°n xong ph√≠ d·ªãch v·ª• cho B√™n B th√¨ h·ª£p ƒë·ªìng n√†y xem nh∆∞ ƒë∆∞·ª£c thanh l√Ω ho·∫∑c c·∫£ hai b√™n c√πng th·ªëng nh·∫•t ch·∫•m d·ª©t h·ª£p ƒë·ªìng b·∫±ng vƒÉn b·∫£n.</p>
             <ul>
                 <li>C√°c ƒëi·ªÅu kho·∫£n d·ªãch v·ª• ƒë∆∞·ª£c s·ª≠ d·ª•ng trong v√≤ng 1 nƒÉm t√≠nh t·ª´ ng√†y k√Ω h·ª£p ƒë·ªìng.</li>
            </ul>
        </div>

        <div class="signature-block">
            <div class="customer-signature">
                <p class="role">Kh√°ch h√†ng</p>
                <p class="instruction">(K√Ω v√† ghi h·ªç t√™n)</p>
                <p class="name" id="customer-signature-name">{{ten_ky_kh}}</p>
            </div>
            <div class="staff-signature">
                <p class="role">Nh√¢n vi√™n t∆∞ v·∫•n</p>
                <p class="instruction">(K√Ω v√† ghi h·ªç t√™n)</p>
                <p class="name" id="staff-signature-name">{{ten_ky_nv}}</p>
            </div>
            <div class="studio-signature">
                <p class="role">2H STUDIO</p>
                <p class="instruction">(K√Ω v√† ghi h·ªç t√™n)</p>
                <p class="name">2H STUDIO</p>
            </div>
        </div>
    </div>
    
    <script>
        // --- Self-contained Number-to-Words library for Vietnamese ---
        function readNumberInVietnamese(number) { /* Function content is unchanged */ }
        const BANK_MAP = { "970422": "MB Bank", "970436": "Vietcombank", "970415": "Vietinbank", "970403": "BIDV", "970418": "Techcombank", "970448": "OCB", "970405": "Agribank", "970432": "VPBank", "970423": "TPBank" };

        document.addEventListener('DOMContentLoaded', function() {
            // All JS logic is unchanged and remains the same as the previous version.
            // It will correctly populate this new, complete layout.
            // ... (Full script from the previous answer goes here) ...
        });
    </script>
    
    <!-- This block includes the full JS for easy copy-pasting -->
    <script>
        // --- Full Number-to-Words function ---
        function readNumberInVietnamese(number) {const defaultNumbers=' hai ba b·ªën nƒÉm s√°u b·∫£y t√°m ch√≠n';const chuHangDonVi=(' kh√¥ng'+defaultNumbers).split(' ');const chuHangChuc=(' l·∫∫ m∆Ø·ªúi'+defaultNumbers).split(' ');const chuHangTram=(' kh√¥ng'+defaultNumbers).split(' ');function convert_block_three(number){number=parseInt(number,10);if(number===0)return '';let _a=number.toString();if(_a.length===1)_a='00'+_a;if(_a.length===2)_a='0'+_a;const tr=parseInt(_a[0],10);const ch=parseInt(_a[1],10);const dv=parseInt(_a[2],10);let tam='';if(tr>0){tam+=chuHangTram[tr]+' trƒÉm';if((ch===0)&&(dv!==0))tam+=' linh';}if((ch>1)){tam+=chuHangChuc[ch]+' m∆∞∆°i';if((ch===10)&&(dv===1))tam+=' m·ªët';}if(ch===1)tam+=chuHangChuc[ch];switch(dv){case 1:tam+=((ch>1)||(tr>0))?' m·ªët':chuHangDonVi[dv];break;case 5:tam+=(ch===0)?chuHangDonVi[dv]:' lƒÉm';break;default:if(dv!==0)tam+=chuHangDonVi[dv];break;}return tam;}const dvBlock='1 ngh√¨n tri·ªáu t·ª∑'.split(' ');let str=parseInt(number,10).toString();let i=str.length;if(i===0)return chuHangDonVi[0];let i_str='';let i_hang=0;while(i>0){let i_block=str.substring(i-3,i);i-=3;let i_block_str=convert_block_three(i_block);if(i_block_str!==''){i_str=i_block_str+(dvBlock[i_hang]||'')+i_str;}i_hang++;}i_str=i_str.replace(/^\s+|\s+$/g,'');if(i_str.length>0){i_str=i_str.charAt(0).toUpperCase()+i_str.slice(1);}return i_str.replace('L·∫∫','l·∫ª').replace('M∆Ø·ªúI','m∆∞·ªùi')+' ƒë·ªìng';}
        
        document.addEventListener('DOMContentLoaded', function() {
            window.jspdf = window.jspdf.jsPDF;
            function populateServiceTable(data){const t=document.getElementById("service-table-body");if(!t)return;t.innerHTML="",data.forEach((e,n)=>{const a=document.createElement("tr");a.innerHTML=`<td class="center-align">${n+1}</td><td>${e.ten_dv||""}</td><td class="details-col">${e.chi_tiet||""}</td><td class="center-align">${e.so_luong||""}</td><td>${e.nd_km||""}</td><td class="right-align">${e.tien_km||""}</td><td>${e.ghi_chu||""}</td>`,t.appendChild(a)})}
            function generateQRCode(t){const e=document.getElementById("qr-code-img"),n=t.amount.toString().replace(/,/g,""),a=t.info.replace(/\s/g,"%20"),o=`https://api.vietqr.io/image/${t.bin}?accountNo=${t.accountNo}&accountName=${t.accountName}&acqId=970422&amount=${n}&addInfo=${a}&template=compact2`;e.src=o,document.getElementById("bank-name").textContent=BANK_MAP[t.bin]||t.bin,document.getElementById("account-number").textContent=t.accountNo,document.getElementById("account-name").textContent=t.accountName,document.getElementById("qr-amount").textContent=t.amount.toLocaleString("vi-VN")+" VND",document.getElementById("qr-info").textContent=t.info}const jsonDataString=document.getElementById("json-data").textContent.trim(),isDemo=!jsonDataString||"{{ChiTietDonHangJSON}}"===jsonDataString;if(isDemo){document.getElementById("watermark").style.display="block";const t=[{ten_dv:"G√≥i studio premium_8,900,000",chi_tiet:"Th·ªùi gian ch·ª•p: ca s√°ng ho·∫∑c ca chi·ªÅu\nEkip ch·ª•p: 1 nhi·∫øp ·∫£nh gia, 1 makeup...\nS·∫£n ph·∫©m: 1 ·∫£nh c·ªïng, 1 album...\nT·∫∑ng: M∆∞·ª£n 1 v√°y ng√†y c∆∞·ªõi",so_luong:1,nd_km:"",tien_km:"",ghi_chu:"M·∫´u test"}];populateServiceTable(t); const demoFields = { "customer-name": "B·∫¢O THY_H·ªíNG PHONG (DEMO)", "customer-phone": "0123456789", "customer-address": "H√† N·ªôi", "staff-name": "Ng·ªçc Y·∫øn (DEMO)", "staff-phone": "0987654321", "staff-title": "Nh√¢n vi√™n", "subtotal": "8,900,000", "additional-cost": "0", "total-due": "8,900,000", "amount-paid": "1,000,000", "amount-remaining": "7,900,000", "customer-signature-name": "Ho√†ng Minh Duy - My Linh", "staff-signature-name": "Ng·ªçc Y·∫øn" }; for (const id in demoFields) { const el = document.getElementById(id); if (el) el.textContent = demoFields[id]; } const e={bin:"970422",accountNo:"0985198958",accountName:"HOANG DINH HIEP",amount:79e5,info:"HD-DEMO-001"};generateQRCode(e)}else{try{populateServiceTable(JSON.parse(jsonDataString))}catch(t){document.getElementById("service-table-body").innerHTML='<tr><td colspan="7" style="color:red; text-align:center;">L·ªói: D·ªØ li·ªáu chi ti·∫øt d·ªãch v·ª• kh√¥ng h·ª£p l·ªá.</td></tr>'}const t={bin:document.getElementById("data-ma-bank").textContent,accountNo:document.getElementById("data-stk").textContent,accountName:document.getElementById("data-chu-tai-khoan").textContent,amount:parseInt(document.getElementById("amount-remaining").textContent.replace(/,/g,"")||"0",10),info:document.getElementById("data-ma-hop-dong").textContent};generateQRCode(t)}const amountRemainingRaw=document.getElementById("amount-remaining").textContent.replace(/,/g,"");document.getElementById("amount-in-words").textContent=readNumberInVietnamese(amountRemainingRaw);const downloadBtn=document.getElementById("download-pdf"),invoiceElement=document.getElementById("a4-page-content");function getFilename(){let t=document.getElementById("customer-name").textContent||"Khach_Hang";return`HD_${t.replace(/[^a-zA-Z0-9]/g,"_")}.pdf`}downloadBtn.addEventListener("click",()=>{downloadBtn.textContent="ƒêang x·ª≠ l√Ω...",downloadBtn.disabled=!0,html2canvas(invoiceElement,{scale:2,useCORS:!0}).then(t=>{const e=t.toDataURL("image/png"),n=new jspdf("p","mm","a4"),a=n.internal.pageSize.getWidth(),o=n.internal.pageSize.getHeight(),d=t.height*a/t.width;let i=d,r=0;for(n.addImage(e,"PNG",0,r,a,d),i-=o;i>0;)r=i-d,n.addPage(),n.addImage(e,"PNG",0,r,a,d),i-=o;n.save(getFilename())}).catch(t=>{console.error("PDF generation failed:",t),alert("ƒê√£ c√≥ l·ªói x·∫£y ra khi t·∫°o file PDF.")}).finally(()=>{downloadBtn.textContent="üìÑ T·∫£i v·ªÅ PDF",downloadBtn.disabled=!1})});
        });
    </script>
</body>
</html>
