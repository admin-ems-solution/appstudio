<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phi·∫øu Thu - Chi (M·∫´u 01-TT)</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        /* Font chu·∫©n vƒÉn b·∫£n h√†nh ch√≠nh */
        @import url('https://fonts.googleapis.com/css2?family=Times+New+Roman:ital,wght@0,400;0,700;1,400;1,700&display=swap');
        
        body { 
            font-family: 'Times New Roman', serif; 
            font-size: 11pt; 
            line-height: 1.3; 
            color: #000; 
            background-color: #f0f2f5; 
            margin: 0; 
            padding: 0; 
        }

        /* --- C·∫•u h√¨nh trang in A4 Ngang --- */
        @page { 
            size: A4 landscape; 
            margin: 10mm; 
        }

        .actions-container { 
            position: sticky; top: 0; display: flex; justify-content: center; align-items: center;
            width: 100%; background-color: #343a40; padding: 10px; box-sizing: border-box;
            z-index: 2000; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            gap: 15px;
        }
        .action-btn { 
            background-color: #0d6efd; color: white; border: none; padding: 8px 16px; border-radius: 4px; 
            font-size: 14px; cursor: pointer; font-family: sans-serif;
        }

        /* Container ch√≠nh ch·ª©a 2 li√™n */
        .page-wrapper { 
            display: flex; 
            justify-content: center; 
            padding: 20px; 
        }

        .a4-landscape-sheet {
            width: 297mm;
            height: 210mm;
            background: white;
            display: flex; /* Chia ƒë√¥i trang */
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            padding: 10mm;
            box-sizing: border-box;
        }

        /* M·ªôt li√™n (chi·∫øm 50% chi·ªÅu r·ªông) */
        .voucher-half {
            flex: 1;
            padding: 0 15px;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* ƒê∆∞·ªùng c·∫Øt gi·ªØa 2 li√™n */
        .cut-line {
            width: 1px;
            border-left: 2px dashed #999;
            margin: 0 10px;
            height: 100%;
        }

        /* --- Header --- */
        .header-top { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; }
        
        .unit-info { width: 55%; font-size: 10pt; }
        .unit-info p { margin: 2px 0; }
        .unit-info .studio-name { font-weight: bold; text-transform: uppercase; }

        .form-meta { width: 45%; text-align: center; font-size: 10pt; }
        .form-meta .meta-title { font-weight: bold; margin-bottom: 2px; }
        .form-meta .meta-sub { font-style: italic; font-size: 9pt; margin-top: 0; }

        /* --- Title --- */
        .voucher-title-section { text-align: center; margin-bottom: 15px; position: relative; }
        .voucher-main-title { font-size: 18pt; font-weight: bold; margin: 0; text-transform: uppercase; }
        .voucher-date { font-style: italic; margin-top: 5px; }

        /* S·ªë phi·∫øu b√™n ph·∫£i ti√™u ƒë·ªÅ */
        .voucher-number-block {
            position: absolute;
            top: 0;
            right: 0;
            text-align: left;
            font-size: 10pt;
        }

        /* --- Body --- */
        .content-lines { margin-bottom: 15px; }
        .line-row { margin-bottom: 8px; display: flex; align-items: baseline; }
        .line-label { white-space: nowrap; margin-right: 5px; }
        .line-value { 
            flex-grow: 1; 
            border-bottom: 1px dotted #000; 
            font-weight: bold; 
            padding-left: 5px;
        }
        .line-value.italic { font-weight: normal; font-style: italic; }

        /* --- Signatures (5 c·ªôt) --- */
        .signature-section { 
            display: flex; 
            justify-content: space-between; 
            text-align: center; 
            margin-top: 10px;
        }
        .sig-col { width: 19%; }
        .sig-title { font-weight: bold; font-size: 10pt; margin-bottom: 2px; }
        .sig-sub { font-style: italic; font-size: 9pt; margin-top: 0; margin-bottom: 50px; }
        .sig-name { font-weight: bold; margin-top: 50px; }

        @media print {
            body { background: none; margin: 0; }
            .actions-container { display: none; }
            .page-wrapper { padding: 0; }
            .a4-landscape-sheet { box-shadow: none; width: 100%; height: 100%; padding: 5mm; }
        }
    </style>
</head>
<body>

    <div class="actions-container">
        <button onclick="window.print()" class="action-btn">üñ®Ô∏è In Phi·∫øu</button>
        <button onclick="downloadPDF()" class="action-btn">üìÑ T·∫£i PDF</button>
    </div>

    <div class="page-wrapper">
        <div class="a4-landscape-sheet" id="print-area">
            
            <!-- LI√äN 1 -->
            <div class="voucher-half">
                <div class="header-top">
                    <div class="unit-info">
                        <p>ƒê∆°n v·ªã: <span class="data-ten-studio">...</span></p>
                        <p>ƒê·ªãa ch·ªâ: <span class="data-dia-chi-studio">...</span></p>
                    </div>
                    <div class="form-meta">
                        <div class="meta-title">M·∫´u s·ªë 01 - TT</div>
                        <div class="meta-sub">(Ban h√†nh theo Th√¥ng t∆∞ s·ªë 200/2014/TT-BTC<br>Ng√†y 22/12/2014 c·ªßa B·ªô T√†i ch√≠nh)</div>
                    </div>
                </div>

                <div class="voucher-title-section">
                    <h1 class="voucher-main-title data-tieu-de">PHI·∫æU THU</h1>
                    <div class="voucher-date data-ngay-thang">Ng√†y ... th√°ng ... nƒÉm ...</div>
                    
                    <div class="voucher-number-block">
                        <div>Quy·ªÉn s·ªë: ..........</div>
                        <div>S·ªë: <span class="data-ma-phieu">..........</span></div>
                    </div>
                </div>

                <div class="content-lines">
                    <div class="line-row">
                        <span class="line-label data-label-nguoi-nop">H·ªç v√† t√™n ng∆∞·ªùi n·ªôp ti·ªÅn:</span>
                        <span class="line-value data-nguoi-nop"></span>
                    </div>
                    <div class="line-row">
                        <span class="line-label">ƒê·ªãa ch·ªâ:</span>
                        <span class="line-value data-dia-chi-kh"></span>
                    </div>
                    <div class="line-row">
                        <span class="line-label">L√Ω do n·ªôp:</span>
                        <span class="line-value data-ly-do"></span>
                    </div>
                    <div class="line-row">
                        <span class="line-label">S·ªë ti·ªÅn:</span>
                        <span class="line-value data-so-tien"></span>
                    </div>
                    <div class="line-row">
                        <span class="line-label">(Vi·∫øt b·∫±ng ch·ªØ):</span>
                        <span class="line-value italic data-so-tien-chu"></span>
                    </div>
                    <div class="line-row">
                        <span class="line-label">K√®m theo:</span>
                        <span class="line-value italic data-kem-theo"></span>
                        <span class="line-label">Ch·ª©ng t·ª´ g·ªëc</span>
                    </div>
                </div>

                <div class="voucher-date" style="text-align: right; margin-bottom: 5px;">
                    <span class="data-ngay-thang">Ng√†y ... th√°ng ... nƒÉm ...</span>
                </div>

                <div class="signature-section">
                    <div class="sig-col">
                        <div class="sig-title">Gi√°m ƒë·ªëc</div>
                        <p class="sig-sub">(K√Ω, h·ªç t√™n, ƒë√≥ng d·∫•u)</p>
                    </div>
                    <div class="sig-col">
                        <div class="sig-title">K·∫ø to√°n tr∆∞·ªüng</div>
                        <p class="sig-sub">(K√Ω, h·ªç t√™n)</p>
                    </div>
                    <div class="sig-col">
                        <div class="sig-title data-label-nguoi-nop-ky">Ng∆∞·ªùi n·ªôp ti·ªÅn</div>
                        <p class="sig-sub">(K√Ω, h·ªç t√™n)</p>
                        <div class="sig-name data-nguoi-nop"></div>
                    </div>
                    <div class="sig-col">
                        <div class="sig-title">Ng∆∞·ªùi l·∫≠p phi·∫øu</div>
                        <p class="sig-sub">(K√Ω, h·ªç t√™n)</p>
                        <div class="sig-name data-nguoi-lap"></div>
                    </div>
                    <div class="sig-col">
                        <div class="sig-title">Th·ªß qu·ªπ</div>
                        <p class="sig-sub">(K√Ω, h·ªç t√™n)</p>
                    </div>
                </div>
            </div>

            <!-- ƒê∆Ø·ªúNG C·∫ÆT -->
            <div class="cut-line"></div>

            <!-- LI√äN 2 (Copy y h·ªát Li√™n 1) -->
            <div class="voucher-half">
                <div class="header-top">
                    <div class="unit-info">
                        <p>ƒê∆°n v·ªã: <span class="data-ten-studio">...</span></p>
                        <p>ƒê·ªãa ch·ªâ: <span class="data-dia-chi-studio">...</span></p>
                    </div>
                    <div class="form-meta">
                        <div class="meta-title">M·∫´u s·ªë 01 - TT</div>
                        <div class="meta-sub">(Ban h√†nh theo Th√¥ng t∆∞ s·ªë 200/2014/TT-BTC<br>Ng√†y 22/12/2014 c·ªßa B·ªô T√†i ch√≠nh)</div>
                    </div>
                </div>

                <div class="voucher-title-section">
                    <h1 class="voucher-main-title data-tieu-de">PHI·∫æU THU</h1>
                    <div class="voucher-date data-ngay-thang">Ng√†y ... th√°ng ... nƒÉm ...</div>
                    
                    <div class="voucher-number-block">
                        <div>Quy·ªÉn s·ªë: ..........</div>
                        <div>S·ªë: <span class="data-ma-phieu">..........</span></div>
                    </div>
                </div>

                <div class="content-lines">
                    <div class="line-row">
                        <span class="line-label data-label-nguoi-nop">H·ªç v√† t√™n ng∆∞·ªùi n·ªôp ti·ªÅn:</span>
                        <span class="line-value data-nguoi-nop"></span>
                    </div>
                    <div class="line-row">
                        <span class="line-label">ƒê·ªãa ch·ªâ:</span>
                        <span class="line-value data-dia-chi-kh"></span>
                    </div>
                    <div class="line-row">
                        <span class="line-label">L√Ω do n·ªôp:</span>
                        <span class="line-value data-ly-do"></span>
                    </div>
                    <div class="line-row">
                        <span class="line-label">S·ªë ti·ªÅn:</span>
                        <span class="line-value data-so-tien"></span>
                    </div>
                    <div class="line-row">
                        <span class="line-label">(Vi·∫øt b·∫±ng ch·ªØ):</span>
                        <span class="line-value italic data-so-tien-chu"></span>
                    </div>
                    <div class="line-row">
                        <span class="line-label">K√®m theo:</span>
                        <span class="line-value italic data-kem-theo"></span>
                        <span class="line-label">Ch·ª©ng t·ª´ g·ªëc</span>
                    </div>
                </div>

                <div class="voucher-date" style="text-align: right; margin-bottom: 5px;">
                    <span class="data-ngay-thang">Ng√†y ... th√°ng ... nƒÉm ...</span>
                </div>

                <div class="signature-section">
                    <div class="sig-col">
                        <div class="sig-title">Gi√°m ƒë·ªëc</div>
                        <p class="sig-sub">(K√Ω, h·ªç t√™n, ƒë√≥ng d·∫•u)</p>
                    </div>
                    <div class="sig-col">
                        <div class="sig-title">K·∫ø to√°n tr∆∞·ªüng</div>
                        <p class="sig-sub">(K√Ω, h·ªç t√™n)</p>
                    </div>
                    <div class="sig-col">
                        <div class="sig-title data-label-nguoi-nop-ky">Ng∆∞·ªùi n·ªôp ti·ªÅn</div>
                        <p class="sig-sub">(K√Ω, h·ªç t√™n)</p>
                        <div class="sig-name data-nguoi-nop"></div>
                    </div>
                    <div class="sig-col">
                        <div class="sig-title">Ng∆∞·ªùi l·∫≠p phi·∫øu</div>
                        <p class="sig-sub">(K√Ω, h·ªç t√™n)</p>
                        <div class="sig-name data-nguoi-lap"></div>
                    </div>
                    <div class="sig-col">
                        <div class="sig-title">Th·ªß qu·ªπ</div>
                        <p class="sig-sub">(K√Ω, h·ªç t√™n)</p>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        function readNumberInVietnamese(number) { 
            const units=["","m·ªôt","hai","ba","b·ªën","nƒÉm","s√°u","b·∫£y","t√°m","ch√≠n"];
            const groupUnits=[""," ngh√¨n"," tri·ªáu"," t·ª∑"," ngh√¨n t·ª∑"," tri·ªáu t·ª∑"];
            function convertBlock(e){if("000"===e)return"";let t=parseInt(e[0]),r=parseInt(e[1]),n=parseInt(e[2]),i="";return t>0&&(i+=units[t]+" trƒÉm"),0===r&&n>0?i+=t>0?" linh "+units[n]:units[n]:1===r?(i+=" m∆∞·ªùi",5===n?i+=" lƒÉm":n>0&&(i+=" "+units[n])):r>1&&(i+=" "+units[r]+" m∆∞∆°i",1===n?i+=" m·ªët":5===n?i+=" lƒÉm":n>0&&(i+=" "+units[n])),i.trim()}
            let numStr=String(parseInt(number,10)); if("0"===numStr||isNaN(parseInt(number))) return "Kh√¥ng ƒë·ªìng";
            let chunks=[]; for(;numStr.length>0;)chunks.unshift(numStr.slice(-3)),numStr=numStr.slice(0,-3);
            const result=chunks.map((e,t)=>{for(;e.length<3;)e="0"+e;const r=convertBlock(e);if(!r)return"";let n=groupUnits[chunks.length-1-t];return 0===parseInt(e)&&" ngh√¨n"===n?"":r+n}).filter(Boolean).join(" ");
            let final = (result.charAt(0).toUpperCase()+result.slice(1)).trim()+" ƒë·ªìng ch·∫µn";
            return final.replace(/  /g, " "); 
        }

        function setTextByClass(className, text) {
            const elements = document.querySelectorAll('.' + className);
            elements.forEach(el => el.textContent = text);
        }

        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            
            // D·ªØ li·ªáu m·∫∑c ƒë·ªãnh (Demo)
            let data = {
                hang_muc: 'Thu',
                ten_studio: '2H STUDIO',
                dia_chi_studio: '111 Ho√†ng C·∫ßu - H√† N·ªôi',
                ngay_lap: '2025-10-15',
                ma_phieu: 'PT001',
                doi_tuong: 'Nguy·ªÖn VƒÉn A',
                dia_chi_kh: 'H√† N·ªôi',
                noi_dung: 'Thanh to√°n ti·ªÅn ch·ª•p ·∫£nh',
                so_tien: '5000000',
                nguoi_tao: 'Admin',
                kem_theo: '01 H√≥a ƒë∆°n b√°n l·∫ª'
            };

            // Ghi ƒë√® b·∫±ng d·ªØ li·ªáu URL n·∫øu c√≥
            if (urlParams.has('so_tien')) {
                data.hang_muc = urlParams.get('hang_muc') || 'Thu';
                data.ten_studio = urlParams.get('ten_studio');
                data.dia_chi_studio = urlParams.get('diachi_studio');
                data.ngay_lap = urlParams.get('ngay_lap');
                data.ma_phieu = urlParams.get('id_thu_chi');
                data.doi_tuong = urlParams.get('doi_tuong');
                data.dia_chi_kh = urlParams.get('dia_chi') || '';
                data.noi_dung = urlParams.get('noi_dung');
                data.so_tien = urlParams.get('so_tien');
                data.nguoi_tao = urlParams.get('nguoi_tao');
                data.kem_theo = urlParams.get('giay_bao') || '...........................';
            }

            // X·ª≠ l√Ω Logic Thu/Chi
            const isChi = data.hang_muc.toLowerCase() === 'chi';

            // 1. Ti√™u ƒë·ªÅ v√† Nh√£n
            setTextByClass('data-tieu-de', isChi ? 'PHI·∫æU CHI' : 'PHI·∫æU THU');
            setTextByClass('data-label-nguoi-nop', isChi ? 'H·ªç v√† t√™n ng∆∞·ªùi nh·∫≠n ti·ªÅn:' : 'H·ªç v√† t√™n ng∆∞·ªùi n·ªôp ti·ªÅn:');
            setTextByClass('data-label-nguoi-nop-ky', isChi ? 'Ng∆∞·ªùi nh·∫≠n ti·ªÅn' : 'Ng∆∞·ªùi n·ªôp ti·ªÅn');

            // 2. Th√¥ng tin chung
            setTextByClass('data-ten-studio', data.ten_studio);
            setTextByClass('data-dia-chi-studio', data.dia_chi_studio);
            setTextByClass('data-ma-phieu', data.ma_phieu);
            setTextByClass('data-nguoi-nop', data.doi_tuong);
            setTextByClass('data-dia-chi-kh', data.dia_chi_kh);
            setTextByClass('data-ly-do', data.noi_dung);
            setTextByClass('data-nguoi-lap', data.nguoi_tao);
            setTextByClass('data-kem-theo', data.kem_theo);

            // 3. Ng√†y th√°ng
            let d = new Date();
            if(data.ngay_lap) d = new Date(data.ngay_lap);
            if(isNaN(d.getTime())) d = new Date(); // Fallback n·∫øu l·ªói ng√†y
            const dateStr = `Ng√†y ${d.getDate().toString().padStart(2,'0')} th√°ng ${(d.getMonth()+1).toString().padStart(2,'0')} nƒÉm ${d.getFullYear()}`;
            setTextByClass('data-ngay-thang', dateStr);

            // 4. Ti·ªÅn
            const rawMoney = data.so_tien.toString().replace(/,/g, '').replace(/\./g, '');
            const moneyVal = parseInt(rawMoney, 10);
            setTextByClass('data-so-tien', moneyVal.toLocaleString('vi-VN') + ' VNƒê');
            setTextByClass('data-so-tien-chu', readNumberInVietnamese(moneyVal));
            
            document.title = (isChi ? "PC_" : "PT_") + data.ma_phieu;
        });

        function downloadPDF() {
            const element = document.getElementById('print-area');
            const opt = {
                margin: 0,
                filename: document.title + '.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' }
            };
            html2pdf().from(element).set(opt).save();
        }
    </script>
</body>
</html>
