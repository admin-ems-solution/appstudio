<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phi·∫øu Thu - Chi (A4 D·ªçc)</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Times+New+Roman:ital,wght@0,400;0,700;1,400;1,700&display=swap');
        
        body { 
            font-family: 'Times New Roman', serif; 
            font-size: 11pt; 
            line-height: 1.3; 
            color: #000; 
            background-color: #f0f2f5; 
            margin: 0; 
            padding: 0; 
        }

        /* C·∫•u h√¨nh kh·ªï gi·∫•y A4 D·ªçc */
        @page { 
            size: A4 portrait; 
            margin: 0; /* CƒÉn l·ªÅ 0 ƒë·ªÉ t·ª± ch·ªß ƒë·ªông padding b√™n trong */
        }

        .actions-container { 
            position: sticky; top: 0; display: flex; justify-content: center; gap: 15px;
            width: 100%; background-color: #343a40; padding: 10px; z-index: 2000; 
        }
        .action-btn { 
            background-color: #0d6efd; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;
        }

        .page-wrapper { 
            display: flex; justify-content: center; padding: 20px; 
        }

        .a4-page {
            width: 210mm;
            height: 297mm; /* Chi·ªÅu cao A4 chu·∫©n */
            background: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            box-sizing: border-box;
            display: flex;
            flex-direction: column; /* X·∫øp d·ªçc */
        }

        /* M·ªôt li√™n chi·∫øm 50% chi·ªÅu cao */
        .voucher-half {
            height: 50%;
            padding: 15mm 20mm; /* L·ªÅ trong: Tr√™n d∆∞·ªõi 15mm, Tr√°i ph·∫£i 20mm */
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* ƒê∆∞·ªùng c·∫Øt ngang ·ªü gi·ªØa trang */
        .cut-line {
            width: 90%;
            margin: 0 auto;
            border-top: 2px dashed #999;
        }

        /* --- Header theo m·∫´u ·∫£nh --- */
        .header-section { display: flex; align-items: flex-start; margin-bottom: 10px; gap: 15px; }
        
        .logo-box { 
            width: 80px; height: 80px; 
            display: flex; align-items: center; justify-content: center;
        }
        .logo-box img { 
            max-width: 100%; max-height: 100%; object-fit: contain; 
            /* border-radius: 50%; N·∫øu logo tr√≤n th√¨ b·ªè comment d√≤ng n√†y */
        }

        .studio-info { flex: 1; font-size: 11pt; }
        .studio-name { font-weight: bold; font-size: 12pt; text-transform: uppercase; margin-bottom: 4px; display: block;}
        .studio-line { display: block; margin-bottom: 2px; }

        /* --- Ti√™u ƒë·ªÅ & S·ªë phi·∫øu --- */
        .title-row { position: relative; text-align: center; margin-bottom: 15px; margin-top: 10px; }
        .main-title { font-size: 19pt; font-weight: bold; text-transform: uppercase; margin: 0; }
        .date-sub { font-style: italic; font-size: 11pt; margin: 5px 0; }
        .copy-number { font-weight: bold; font-size: 10pt; }

        .voucher-number {
            position: absolute;
            top: 0; right: 0;
            text-align: left; font-size: 10pt;
        }

        /* --- N·ªôi dung ch√≠nh --- */
        .body-content { flex-grow: 1; }
        .line-row { display: flex; align-items: baseline; margin-bottom: 8px; }
        .label { white-space: nowrap; margin-right: 5px; }
        .value { flex-grow: 1; border-bottom: 1px dotted #000; font-weight: bold; padding-left: 5px; }
        .value.italic { font-weight: normal; font-style: italic; }

        /* D√≤ng k√©p (H√¨nh th·ª©c + STK) */
        .double-row { display: flex; align-items: baseline; justify-content: space-between; gap: 20px; margin-bottom: 8px; }
        .half-row { display: flex; align-items: baseline; flex: 1; }

        /* --- Ch·ªØ k√Ω (4 c·ªôt) --- */
        .signature-row { display: flex; justify-content: space-between; text-align: center; margin-top: 10px; }
        .sig-col { width: 24%; }
        .sig-head { font-weight: bold; font-size: 11pt; margin-bottom: 3px; }
        .sig-sub { font-style: italic; font-size: 10pt; margin-top: 0; margin-bottom: 60px; }
        .sig-name { font-weight: bold; }

        @media print {
            body { background: none; }
            .actions-container { display: none; }
            .page-wrapper { padding: 0; }
            .a4-page { box-shadow: none; width: 100%; height: 100%; }
        }
    </style>
</head>
<body>

    <div class="actions-container">
        <button onclick="window.print()" class="action-btn">üñ®Ô∏è In Phi·∫øu</button>
        <button onclick="downloadPDF()" class="action-btn">üìÑ T·∫£i PDF</button>
    </div>

    <div class="page-wrapper">
        <div class="a4-page" id="print-area">
            
            <!-- === LI√äN 1 (N·ª¨A TR√äN) === -->
            <div class="voucher-half">
                <!-- Header -->
                <div class="header-section">
                    <div class="logo-box">
                        <img src="https://2hstudio.vn/wp-content/uploads/2024/10/8.jpg" alt="Logo" id="logo-img-1" onerror="this.style.display='none'">
                    </div>
                    <div class="studio-info">
                        <span class="studio-name data-ten-studio">2H STUDIO</span>
                        <span class="studio-line">ƒê·ªãa ch·ªâ: <span class="data-dia-chi-studio">...</span></span>
                        <span class="studio-line">Email: <span class="data-email-studio">...</span></span>
                        <span class="studio-line">ƒêi·ªán tho·∫°i: <span class="data-sdt-studio">...</span> - Zalo: <span class="data-zalo-studio">...</span></span>
                    </div>
                </div>

                <!-- Title -->
                <div class="title-row">
                    <h1 class="main-title data-tieu-de">PHI·∫æU THU</h1>
                    <div class="date-sub data-ngay-thang">Ng√†y ... th√°ng ... nƒÉm ...</div>
                    <div class="copy-number">Li√™n s·ªë 1/2</div> <!-- C·ªë ƒë·ªãnh Li√™n 1 -->
                    
                    <div class="voucher-number">
                        <div>Quy·ªÉn s·ªë: ..........</div>
                        <div>S·ªë: <span class="data-ma-phieu">..........</span></div>
                    </div>
                </div>

                <!-- Content -->
                <div class="body-content">
                    <div class="line-row">
                        <span class="label data-label-nguoi-nop">H·ªç v√† t√™n ng∆∞·ªùi n·ªôp ti·ªÅn:</span>
                        <span class="value data-nguoi-nop"></span>
                    </div>
                    <div class="line-row">
                        <span class="label">ƒê·ªãa ch·ªâ:</span>
                        <span class="value data-dia-chi-kh"></span>
                    </div>
                    <div class="line-row">
                        <span class="label">L√Ω do n·ªôp:</span>
                        <span class="value data-ly-do"></span>
                    </div>
                    
                    <!-- D√≤ng H√¨nh th·ª©c & STK -->
                    <div class="double-row">
                        <div class="half-row" style="flex: 0.8;">
                            <span class="label">H√¨nh th·ª©c:</span>
                            <span class="value data-hinh-thuc"></span>
                        </div>
                        <div class="half-row" style="flex: 1.2;">
                            <span class="label">STK:</span>
                            <span class="value data-stk"></span>
                        </div>
                    </div>

                    <div class="line-row">
                        <span class="label">S·ªë ti·ªÅn:</span>
                        <span class="value data-so-tien-so"></span>
                    </div>
                    <div class="line-row">
                        <span class="label">(Vi·∫øt b·∫±ng ch·ªØ):</span>
                        <span class="value italic data-so-tien-chu"></span>
                    </div>
                </div>

                <!-- Signatures (ƒê√£ ƒë·ªïi th·ª© t·ª±) -->
                <div class="signature-row">
                    <div class="sig-col">
                        <div class="sig-head data-label-nguoi-nop-ky">Ng∆∞·ªùi n·ªôp ti·ªÅn</div>
                        <p class="sig-sub">(K√Ω, h·ªç t√™n)</p>
                        <div class="sig-name data-nguoi-nop"></div>
                    </div>
                    <div class="sig-col">
                        <div class="sig-head">Ng∆∞·ªùi l·∫≠p phi·∫øu</div>
                        <p class="sig-sub">(K√Ω, h·ªç t√™n)</p>
                        <div class="sig-name data-nguoi-lap"></div>
                    </div>
                    <div class="sig-col">
                        <div class="sig-head">K·∫ø to√°n tr∆∞·ªüng</div>
                        <p class="sig-sub">(K√Ω, h·ªç t√™n)</p>
                    </div>
                    <div class="sig-col">
                        <div class="sig-head">Gi√°m ƒë·ªëc</div>
                        <p class="sig-sub">(K√Ω, h·ªç t√™n, ƒë√≥ng d·∫•u)</p>
                    </div>
                </div>
            </div>

            <!-- ƒê∆Ø·ªúNG C·∫ÆT -->
            <div class="cut-line"></div>

            <!-- === LI√äN 2 (N·ª¨A D∆Ø·ªöI - Copy y h·ªát) === -->
            <div class="voucher-half">
                <!-- Header -->
                <div class="header-section">
                    <div class="logo-box">
                        <img src="https://2hstudio.vn/wp-content/uploads/2024/10/8.jpg" alt="Logo" id="logo-img-2" onerror="this.style.display='none'">
                    </div>
                    <div class="studio-info">
                        <span class="studio-name data-ten-studio">2H STUDIO</span>
                        <span class="studio-line">ƒê·ªãa ch·ªâ: <span class="data-dia-chi-studio">...</span></span>
                        <span class="studio-line">Email: <span class="data-email-studio">...</span></span>
                        <span class="studio-line">ƒêi·ªán tho·∫°i: <span class="data-sdt-studio">...</span> - Zalo: <span class="data-zalo-studio">...</span></span>
                    </div>
                </div>

                <!-- Title -->
                <div class="title-row">
                    <h1 class="main-title data-tieu-de">PHI·∫æU THU</h1>
                    <div class="date-sub data-ngay-thang">Ng√†y ... th√°ng ... nƒÉm ...</div>
                    <div class="copy-number">Li√™n s·ªë 2/2</div> <!-- C·ªë ƒë·ªãnh Li√™n 2 -->
                    
                    <div class="voucher-number">
                        <div>Quy·ªÉn s·ªë: ..........</div>
                        <div>S·ªë: <span class="data-ma-phieu">..........</span></div>
                    </div>
                </div>

                <!-- Content -->
                <div class="body-content">
                    <div class="line-row">
                        <span class="label data-label-nguoi-nop">H·ªç v√† t√™n ng∆∞·ªùi n·ªôp ti·ªÅn:</span>
                        <span class="value data-nguoi-nop"></span>
                    </div>
                    <div class="line-row">
                        <span class="label">ƒê·ªãa ch·ªâ:</span>
                        <span class="value data-dia-chi-kh"></span>
                    </div>
                    <div class="line-row">
                        <span class="label">L√Ω do n·ªôp:</span>
                        <span class="value data-ly-do"></span>
                    </div>
                    
                    <div class="double-row">
                        <div class="half-row" style="flex: 0.8;">
                            <span class="label">H√¨nh th·ª©c:</span>
                            <span class="value data-hinh-thuc"></span>
                        </div>
                        <div class="half-row" style="flex: 1.2;">
                            <span class="label">STK:</span>
                            <span class="value data-stk"></span>
                        </div>
                    </div>

                    <div class="line-row">
                        <span class="label">S·ªë ti·ªÅn:</span>
                        <span class="value data-so-tien-so"></span>
                    </div>
                    <div class="line-row">
                        <span class="label">(Vi·∫øt b·∫±ng ch·ªØ):</span>
                        <span class="value italic data-so-tien-chu"></span>
                    </div>
                </div>

                <!-- Signatures -->
                <div class="signature-row">
                    <div class="sig-col">
                        <div class="sig-head data-label-nguoi-nop-ky">Ng∆∞·ªùi n·ªôp ti·ªÅn</div>
                        <p class="sig-sub">(K√Ω, h·ªç t√™n)</p>
                        <div class="sig-name data-nguoi-nop"></div>
                    </div>
                    <div class="sig-col">
                        <div class="sig-head">Ng∆∞·ªùi l·∫≠p phi·∫øu</div>
                        <p class="sig-sub">(K√Ω, h·ªç t√™n)</p>
                        <div class="sig-name data-nguoi-lap"></div>
                    </div>
                    <div class="sig-col">
                        <div class="sig-head">K·∫ø to√°n tr∆∞·ªüng</div>
                        <p class="sig-sub">(K√Ω, h·ªç t√™n)</p>
                    </div>
                    <div class="sig-col">
                        <div class="sig-head">Gi√°m ƒë·ªëc</div>
                        <p class="sig-sub">(K√Ω, h·ªç t√™n, ƒë√≥ng d·∫•u)</p>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        function readNumberInVietnamese(number) { 
            const units=["","m·ªôt","hai","ba","b·ªën","nƒÉm","s√°u","b·∫£y","t√°m","ch√≠n"];
            const groupUnits=[""," ngh√¨n"," tri·ªáu"," t·ª∑"," ngh√¨n t·ª∑"," tri·ªáu t·ª∑"];
            function convertBlock(e){if("000"===e)return"";let t=parseInt(e[0]),r=parseInt(e[1]),n=parseInt(e[2]),i="";return t>0&&(i+=units[t]+" trƒÉm"),0===r&&n>0?i+=t>0?" linh "+units[n]:units[n]:1===r?(i+=" m∆∞·ªùi",5===n?i+=" lƒÉm":n>0&&(i+=" "+units[n])):r>1&&(i+=" "+units[r]+" m∆∞∆°i",1===n?i+=" m·ªët":5===n?i+=" lƒÉm":n>0&&(i+=" "+units[n])),i.trim()}
            let numStr=String(parseInt(number,10)); if("0"===numStr||isNaN(parseInt(number))) return "Kh√¥ng ƒë·ªìng";
            let chunks=[]; for(;numStr.length>0;)chunks.unshift(numStr.slice(-3)),numStr=numStr.slice(0,-3);
            const result=chunks.map((e,t)=>{for(;e.length<3;)e="0"+e;const r=convertBlock(e);if(!r)return"";let n=groupUnits[chunks.length-1-t];return 0===parseInt(e)&&" ngh√¨n"===n?"":r+n}).filter(Boolean).join(" ");
            let final = (result.charAt(0).toUpperCase()+result.slice(1)).trim()+" ƒë·ªìng ch·∫µn";
            return final.replace(/  /g, " "); 
        }

        function setTextByClass(className, text) {
            const elements = document.querySelectorAll('.' + className);
            elements.forEach(el => el.textContent = text);
        }

        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            
            // D·ªØ li·ªáu m·∫∑c ƒë·ªãnh (Demo)
            let data = {
                hang_muc: 'Thu',
                ten_studio: '2H STUDIO',
                dia_chi_studio: '111 Ho√†ng C·∫ßu',
                email: '2hstudio.net@gmail.com',
                phone: '0826268111',
                zalo: '2H Studio',
                ngay_lap: '2025-10-15',
                ma_phieu: 'PT001',
                doi_tuong: 'Tr∆∞∆°ng Tu·∫•n Hi·ªáp - Ho√†ng Thu Ng·ªçc',
                dia_chi_kh: 'X√£ Huy·ªán T·ªânh',
                noi_dung: 'THANH TO√ÅN L·∫¶N 2',
                so_tien: '6000000',
                nguoi_tao: 'Admin',
                hinh_thuc: 'Chuy·ªÉn kho·∫£n',
                stk: 'ACB-91926'
            };

            // L·∫•y d·ªØ li·ªáu t·ª´ URL
            if (urlParams.has('so_tien')) {
                data.hang_muc = urlParams.get('hang_muc') || 'Thu';
                data.ten_studio = urlParams.get('ten_studio');
                data.dia_chi_studio = urlParams.get('diachi_studio');
                data.email = urlParams.get('email_studio');
                data.phone = urlParams.get('dienthoai_studio');
                data.zalo = urlParams.get('zalo_studio');
                
                data.ngay_lap = urlParams.get('ngay_lap');
                data.ma_phieu = urlParams.get('id_thu_chi');
                data.doi_tuong = urlParams.get('doi_tuong');
                data.dia_chi_kh = urlParams.get('dia_chi') || '';
                data.noi_dung = urlParams.get('noi_dung');
                data.so_tien = urlParams.get('so_tien');
                data.nguoi_tao = urlParams.get('nguoi_tao');
                
                data.hinh_thuc = urlParams.get('hinh_thuc_tt') || '';
                data.stk = urlParams.get('stk') || ''; // L·∫•y STK t·ª´ URL AppSheet
            }

            const isChi = data.hang_muc.toLowerCase() === 'chi';

            // G√°n d·ªØ li·ªáu
            setTextByClass('data-tieu-de', isChi ? 'PHI·∫æU CHI' : 'PHI·∫æU THU');
            setTextByClass('data-label-nguoi-nop', isChi ? 'H·ªç v√† t√™n ng∆∞·ªùi nh·∫≠n ti·ªÅn:' : 'H·ªç v√† t√™n ng∆∞·ªùi n·ªôp ti·ªÅn:');
            setTextByClass('data-label-nguoi-nop-ky', isChi ? 'Ng∆∞·ªùi nh·∫≠n ti·ªÅn' : 'Ng∆∞·ªùi n·ªôp ti·ªÅn');

            setTextByClass('data-ten-studio', data.ten_studio);
            setTextByClass('data-dia-chi-studio', data.dia_chi_studio);
            setTextByClass('data-email-studio', data.email);
            setTextByClass('data-sdt-studio', data.phone);
            setTextByClass('data-zalo-studio', data.zalo);
            
            setTextByClass('data-ma-phieu', data.ma_phieu);
            setTextByClass('data-nguoi-nop', data.doi_tuong);
            setTextByClass('data-dia-chi-kh', data.dia_chi_kh);
            setTextByClass('data-ly-do', data.noi_dung);
            setTextByClass('data-nguoi-lap', data.nguoi_tao);
            setTextByClass('data-hinh_thuc', data.hinh_thuc);
            setTextByClass('data-stk', data.stk);

            let d = new Date();
            if(data.ngay_lap) d = new Date(data.ngay_lap);
            if(isNaN(d.getTime())) d = new Date();
            const dateStr = `Ng√†y ${d.getDate().toString().padStart(2,'0')} th√°ng ${(d.getMonth()+1).toString().padStart(2,'0')} nƒÉm ${d.getFullYear()}`;
            setTextByClass('data-ngay-thang', dateStr);

            const rawMoney = data.so_tien.toString().replace(/,/g, '').replace(/\./g, '');
            const moneyVal = parseInt(rawMoney, 10);
            setTextByClass('data-so-tien-so', moneyVal.toLocaleString('vi-VN') + ' VNƒê');
            setTextByClass('data-so-tien-chu', readNumberInVietnamese(moneyVal));
            
            document.title = (isChi ? "PC_" : "PT_") + data.ma_phieu;
        });

        function downloadPDF() {
            const element = document.getElementById('print-area');
            const opt = {
                margin: 0,
                filename: document.title + '.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };
            html2pdf().from(element).set(opt).save();
        }
    </script>
</body>
</html>
